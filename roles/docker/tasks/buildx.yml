- name: Ensure a CLI plugins directory exists
  file:
    path: "{{ user_home_dir }}/.docker/cli-plugins"
    state: directory

- name: Find out a homebrew prefix
  ansible.builtin.command: brew --prefix
  register: brew_prefix

- name: Create a symbolic link
  ansible.builtin.file:
    src: "{{ brew_prefix }}/opt/docker-compodse/bin/docker-buildx"
    dest: "{{ user_home_dir }}/.docker/cli-plugins/docker-buildx"
    state: link
    force: true
